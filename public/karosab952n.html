
<html>
  <head>
    <meta charset="utf-8">
    <title>WBSim</title>
    <meta name="description" content="Basic Example â€” Networked-Aframe">
    
     <!--AFRAME release + extras with dynamic functionality-->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>  
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/v5.0.0/dist/aframe-extras.js"></script>
        
   <script src="js/0.6.1networked-aframe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>   
    <script src="easyrtc/easyrtc.js"></script>
    
    <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://rawgit.com/urish/aframe-camera-events/master/index.js"></script>    
    <script src="https://cdn.rawgit.com/tizzle/aframe-orbit-controls-component/v0.1.14/dist/aframe-orbit-controls-component.min.js"></script>
<!--     <script src="/js/getThePosition.js"></script> -->
    <script src="/js/userIDplaced.js"></script>
    <script src="/js/body_rot.js"></script>
    <script src="/js/transparent_material.js"></script>
    <script src="/js/vehicle_control.js"></script> 
<!--     <script src="/menuscripts/vehicle_selection.js"></script> -->
    
    <link rel="stylesheet" type="text/css" href="css/ui.css">
    
  </head>
  
  <body>
    
<!--- A-FRAME SCENE ----------------------------------------------------------------------------------------------------->
    <a-scene  
             networked-scene="
      room: basic;
      debug: true;
      transport: websocket;                           
    ">
      <a-assets timeout="15000">
<!-- PATHs of attached models -  stored on github ------------------------------------------------------------------------>
        <a-asset-item id="hmd-obj" src="https://raw.githubusercontent.com/mayorian/3dmodels/master/avatar/avatar.obj"></a-asset-item>
        <a-asset-item id="hmd-mtl" src="https://raw.githubusercontent.com/mayorian/3dmodels/master/avatar/avatar.mtl"></a-asset-item>
       
        <a-asset-item id="body-obj" src="https://cdn.glitch.com/ae1a6582-b74d-4c82-bb71-faf627e4789b%2Fbodys.obj?v=1560985819906"></a-asset-item>
        <a-asset-item id="body-mtl" src=""></a-asset-item>
        
        <a-asset-item id="hand-obj" src="https://cdn.glitch.com/ae1a6582-b74d-4c82-bb71-faf627e4789b%2Fhand.obj?v=1560986411419"></a-asset-item>
        <a-asset-item id="hand-mtl" src=""></a-asset-item>
        
        <a-asset-item id="environment-obj" src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSim2/contryroads.obj"></a-asset-item>
        <a-asset-item id="environment-mtl" src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSim2/contryroads.mtl"></a-asset-item>
        
        
        <a-asset-item id="car-obj" src="https://raw.githubusercontent.com/mayorian/3dmodels/master/sonata/stcar.obj"></a-asset-item>
        <a-asset-item id="car-mtl" src="https://raw.githubusercontent.com/mayorian/3dmodels/master/sonata/stcar.mtl"></a-asset-item>
        
<!--         <a-asset-item id="karosa-obj" src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/karosab732/karosab732.obj"></a-asset-item>
        <a-asset-item id="karosa-mtl" src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/karosab732/karosab732.mtl"></a-asset-item>
        
        <a-asset-item id="skoda-obj" src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/skoda/110/110rskoda.obj"></a-asset-item>
        <a-asset-item id="skoda-mtl" src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/skoda/110/110rskoda.mtl"></a-asset-item>
        
        <a-asset-item id="tatra-obj" src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/tatra/tatra8158x81/tatra8158x81.obj"></a-asset-item>
        <a-asset-item id="tatra-mtl" src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/tatra/tatra8158x81/tatra8158x81.mtl"></a-asset-item> -->
        
         
        <img id="sky4" src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/sunflowers_2k.jpeg" crossorigin="anonymous" />
        <img id="floor" src="https://cdn.glitch.com/976ec309-5c22-4c52-93dd-892d5184766f%2Ffloor.jpg?v=1570193592501" crossorigin="anonymous" />
        <img id="enterbtt" src="https://cdn.glitch.com/976ec309-5c22-4c52-93dd-892d5184766f%2Fplay.png?v=1570197265803" crossorigin="anonymous" />
        <!--<img id="guiarrows" src="https://cdn.glitch.com/976ec309-5c22-4c52-93dd-892d5184766f%2Fnawgui.png?v=1570310226107" crossorigin="anonymous" />-->
      
<!-- Templates - objects utilized in AVATAR MODEL construction ------------------------------------------------------------------------>
         
        <template id="avatar-template">
          <a-entity class="avatar">
                     <!--  <a-obj-model src="#hmd-obj" mtl="#hmd-mtl" scale="0.5 0.5 0.5">
                               <a-cylinder width="0.1" height="2.7" position="0 0 -3.0" rotation="90 0 0" scale="0.005 2 0.005" opacity="0.8" color="white" emissive="white">
                              </a-cylinder>
                        </a-obj-model> -->
          </a-entity>
        </template>
        
         <template id="avatar-karosab732">
          <a-entity class="karosabodyavatar">                        
            <a-obj-model class="objmodelclass" 
                         src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/karosab732/karosab732.obj" 
                         mtl="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/karosab732/karosab732.mtl" 
                         scale="1 1 1" rotation="0 0 0">  </a-obj-model>
            <a-text class="idtext" visible="true" rotation="0 183 0" position="0.71036 2.98203 -9.18899" text="value: -" scale="1.5 1.5 1"></a-text>
          </a-entity>
        </template>  
        
        <template id="avatar-karosab952">
          <a-entity class="karosabodyavatar">                        
            <a-obj-model class="objmodelclass" 
                         src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/karosab951/karosab951.obj" 
                         mtl="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/karosab951/karosab951.mtl" 
                         scale="1 1 1" rotation="0 0 0">  </a-obj-model>
            <a-text class="idtext" visible="true" rotation="0 183 0" position="0.71036 2.98203 -9.18899" text="value: -" scale="1.5 1.5 1"></a-text>
          </a-entity>
        </template> 
        
        <template id="avatar-karosaSM">
          <a-entity class="karosabodyavatar">                        
            <a-obj-model class="objmodelclass" 
                         src="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/karosaSx/karosaSM.obj" 
                         mtl="https://raw.githubusercontent.com/mayorian/glitchproject/master/DrivingSimAFRAME/karosaSx/karosaSM.mtl" 
                         scale="1 1 1" rotation="0 0 0">  </a-obj-model>
            <a-text class="idtext" visible="true" rotation="0 183 0" position="0.71036 2.98203 -9.18899" text="value: -" scale="1.5 1.5 1"></a-text>
          </a-entity>
        </template> 

<!--         <template id="avatar-skoda">
          <a-entity class="skodabodyavatar">                        
            <a-obj-model class="objmodelclass" src="#skoda-obj" mtl="#skoda-mtl" scale="0.8 0.8 0.8" rotation="0 0 0">  </a-obj-model>
            <a-text class="idtext" visible="true" rotation="0 183 0" position="0.71036 2.98203 -8.78899" text="value: Ride" scale="1.5 1.5 1"></a-text>
          </a-entity>
        </template>    

        <template id="avatar-tatra">
          <a-entity class="skodabodyavatar">                        
            <a-obj-model class="objmodelclass" src="#tatra-obj" mtl="#tatra-mtl" scale="0.8 0.8 0.8" rotation="0 0 0">  </a-obj-model>
            <a-text class="idtext" visible="true" rotation="0 183 0" position="0.71036 2.98203 -8.78899" text="value: Ride" scale="1.5 1.5 1"></a-text>
          </a-entity>
        </template> -->
        
       
        <template id="hololens-body">
          <a-entity class="bodyavatar">                        
                
          </a-entity>
        </template>
        
 
    </a-assets> 
<!-- /END OF Templates ---------------------------------------------------------------------------------------------------->

<!--SHARED ENTITIES------------------------------------------------------------------------------------------------------>   
<!--       tu daj prompt skript, ktory id rig nastavi networked prodla template -->
     <a-entity id="fullbody"> 
         <a-entity   
                    id="rig"      
                    networked="template:#avatar-karosab952;attachTemplateToLocal:true;"              
                    position = "-3 0 -3"
                    rotation="0 0 0"
                    vehicle-move-wasd
                    gaze-interaction
                    select-vehicle                 
           > 
<a-entity light="color: #cccfa5; intensity: 3; type: spot; decay: 0.36; distance: 70; shadowCameraFar: 10; angle: 40; penumbra: 0.56" position="0 2.087 -6.635" rotation="-0.7442721758749393 -0.39075721627922144 1.4174975851536566"></a-entity>           <a-text class="idtext" visible="true" head-text ></a-text>
           
                  <a-entity
                            id="playerhead"
                            networked="template:#avatar-template;attachTemplateToLocal:false;"  
                            camera
                            position="0 5 7"
                            orbit-controls="
                                              autoRotate: false;
                                              target: #target;
                                              enableDamping: true;
                                              dampingFactor: 0.125;
                                              rotateSpeed:0.25;
                                              minDistance:3;
                                              maxDistance:100;
                                              " 
                      >
                        <!--SSTART OF CURSOR IMPLEMENTATION ------------------------------------------->
<!--                             <a-entity cursor="fuse: true; fuseTimeout: 500"
                                      position="0 0 -1"
                                      geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
                                      material="color: red; shader: flat">
                            </a-entity> -->

                        <!--START OF TOOLTIP IMPLEMENTATION OBJECT ------------------------------------------------------>    
<!--                               <a-text id="tooltiptext" visible="true" value="-" position="0.0 0 -1" scale="0.3 0.3 1"></a-text>                           -->
                        <!--END OF TOOLTIP IMPLEMENTATION OBJECT ------------------------------------------------------>
                    </a-entity>
                   <a-text class="idtext" visible="true" head-text ></a-text>

        </a-entity>  
       
    </a-entity>
<!-- END OFSHARED ENTITIES------------------------------------------------------------------------------------------------------>   
<!-- NAF SCHEMES ------------------------------------------------------------------------------------------------------>   
  <script  src="vehicles/nafschemes.js" type="text/javascript">  
  </script>
<!-- END OF NAF SCHEMES ------------------------------------------------------------------------------------------------------>
<!-- ENVIRONMENT OBJECTs------------------------------------------------------------------------------------------------------>   
      <a-entity id="target" position="0 0 0" set-target-position > </a-entity> 
      
      <a-obj-model id="environmentmodel" src="#environment-obj" mtl="#environment-mtl" material="alphaTest: 0.5" transparent="true" scale="1 1 1" position="18.492 0 -469.227" rotation="0 -90 0">
      </a-obj-model> 
      
      <a-obj-model id="carmodel" src="#car-obj" mtl="#car-mtl" shadow="receive: false; cast: false" position="19.22301 0 -0.15788" rotation="0 -59.99999999999999 0" scale="1.2 1.2 1.2" material="" obj-model=""></a-obj-model>
      
      <a-entity light="color: #fff; intensity: 0.15; type: ambient;" visible="true"></a-entity>
      

      <a-sky id="skybox"  src="https://cdn.glitch.com/ff4647b2-2e58-40ed-b23c-9fd2e8e158a3%2Fmoonless_golf_2k.jpeg?v=1596332307073" rotation="0 -90" material="" scale="7 7 7" position="0 0 0"></a-sky>
      
      <script> 
      
        var el = document.querySelector('#environmentmodel');
        el.addEventListener('model-loaded', function (e) {
          e.detail.model.traverse(function (node) {
            if ( node.isMesh ) node.material.alphaTest = 0.8;
            if( node.material ) {
                node.material.side = THREE.DoubleSide;
            }
          });
        });
        
      
      </script>
<!-- END OF SCENE ------------------------------------------------------------------------------------------------------>   
    </a-scene> 
    <div class="controls">
      <p>TestingUI in progress</p>
    </div>
  </body>
</html>